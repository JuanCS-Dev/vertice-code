```mermaid
graph LR
    subgraph "Data Flow: Self-Evolution Cycle"
        subgraph "Input Sources"
            T[ğŸ“‹ Task Outcomes]
            M[ğŸ“Š System Metrics]
            E[âš ï¸ Error Events]
            P[ğŸ“ˆ Performance Data]
        end

        subgraph "Memory Ingestion"
            L1[ğŸ’¾ Working Memory<br/>128K tokens]
            L2[ğŸ’¾ Episodic Memory<br/>512K tokens]
            L3[ğŸ’¾ Semantic Memory<br/>256K tokens]
            L4[ğŸ’¾ Procedural Memory<br/>104K tokens]
        end

        subgraph "Metacognitive Processing"
            direction TB
            OBS[ğŸ‘ï¸ Observation<br/>What happened?]
            ANA[ğŸ”¬ Analysis<br/>Why happened?]
            LEA[ğŸ’¡ Learning<br/>What learned?]
            ACT[ğŸ¯ Action<br/>What to do?]

            OBS --> ANA
            ANA --> LEA
            LEA --> ACT
        end

        subgraph "Knowledge Synthesis"
            INS[(ğŸ’ Insight Store<br/>Firestore)]
            CLU[ğŸ” Clustering<br/>Pattern Detection]
            OPP[ğŸ¯ Opportunities<br/>Prioritized]
        end

        subgraph "Evolution Engine"
            direction TB
            POP[ğŸ‘¥ Population<br/>50 candidates]
            EVAL[ğŸ“Š Evaluation<br/>Multi-objective]
            SEL[ğŸ¯ Selection<br/>Tournament]
            GEN[ğŸ§¬ Genetic Ops<br/>Crossover + Mutate]

            POP --> EVAL
            EVAL --> SEL
            SEL --> GEN
            GEN --> POP
        end

        subgraph "Healing System"
            direction TB
            ANO[âš ï¸ Anomaly<br/>Detection]
            DIA[ğŸ”¬ Diagnosis<br/>Root Cause]
            REM[ğŸ”§ Remediation<br/>Auto-Fix]
            VAL[âœ… Validation<br/>Test Fix]

            ANO --> DIA
            DIA --> REM
            REM --> VAL
        end

        subgraph "Output Actions"
            DEP[ğŸš€ Deploy<br/>Evolved Code]
            FIX[ğŸ”§ Apply Fix<br/>System Heal]
            SKL[ğŸ§  New Skill<br/>To Collective]
            MOD[âš™ï¸ Modify Agent<br/>Behavior]
        end

        subgraph "Feedback Collection"
            RES[ğŸ“Š Results<br/>Monitoring]
            IMP[ğŸ“ˆ Impact<br/>Measurement]
            MET[ğŸ¯ Metrics<br/>Updated]
        end

        %% Data Flow Connections
        T --> L1
        M --> L1
        E --> L1
        P --> L1

        L1 --> L2
        L2 --> L3
        L3 --> L4

        L1 --> OBS
        L2 --> OBS
        L3 --> ANA
        L4 --> LEA

        ACT --> INS
        INS --> CLU
        CLU --> OPP

        OPP -->|Evolution Request| POP
        OPP -->|Healing Request| ANO

        M --> ANO
        E --> ANO

        GEN -->|Best Solution| DEP
        VAL -->|Validated Fix| FIX
        LEA -->|New Knowledge| SKL
        ACT -->|Improvement| MOD

        DEP --> RES
        FIX --> RES
        SKL --> RES
        MOD --> RES

        RES --> IMP
        IMP --> MET
        MET -->|New Data| T
        MET -->|New Data| M

        %% Gemini Integration
        GEM[âš¡ Gemini 3<br/>1M Context<br/>Deep Think]

        ANA -.->|Deep Reasoning| GEM
        GEN -.->|Code Generation| GEM
        DIA -.->|Causal Analysis| GEM

        GEM -.->|Insights| ANA
        GEM -.->|Mutations| GEN
        GEM -.->|Diagnosis| DIA
    end

    classDef inputNode fill:#ffeaa7,stroke:#fdcb6e,stroke-width:2px,color:#333
    classDef memoryNode fill:#a8edea,stroke:#fed6e3,stroke-width:2px,color:#333
    classDef processNode fill:#f093fb,stroke:#f5576c,stroke-width:2px,color:#fff
    classDef knowledgeNode fill:#667eea,stroke:#764ba2,stroke-width:2px,color:#fff
    classDef evolutionNode fill:#43e97b,stroke:#38f9d7,stroke-width:2px,color:#333
    classDef healingNode fill:#4facfe,stroke:#00f2fe,stroke-width:2px,color:#fff
    classDef outputNode fill:#fa709a,stroke:#fee140,stroke-width:2px,color:#fff
    classDef feedbackNode fill:#a8edea,stroke:#fed6e3,stroke-width:2px,color:#333
    classDef aiNode fill:#764ba2,stroke:#667eea,stroke-width:3px,color:#fff

    class T,M,E,P inputNode
    class L1,L2,L3,L4 memoryNode
    class OBS,ANA,LEA,ACT processNode
    class INS,CLU,OPP knowledgeNode
    class POP,EVAL,SEL,GEN evolutionNode
    class ANO,DIA,REM,VAL healingNode
    class DEP,FIX,SKL,MOD outputNode
    class RES,IMP,MET feedbackNode
    class GEM aiNode
```
